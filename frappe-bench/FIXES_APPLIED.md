# Fixes Applied - November 27, 2025

## Issues Fixed

### 1. Redis Queue Port Mismatch ✅
**Problem:** Redis queue was starting on port 6379 (default) instead of port 11000 as configured.

**Root Cause:** Redis config file was correct, but Redis might have been loading default configs or the config wasn't being enforced properly.

**Solution:**
- Enhanced `generate_redis_configs.sh` to include more explicit Redis configuration options
- Updated `bench-manage.sh` to:
  - Verify config file has correct port before starting
  - Explicitly pass `--port 11000` flag to override any defaults
  - Regenerate config if port is incorrect

**Files Modified:**
- `config/generate_redis_configs.sh` - Added more Redis configuration options
- `bench-manage.sh` - Enhanced `cmd_redis_queue()` and `cmd_redis_cache()` functions

### 2. esbuild Platform Mismatch ✅
**Problem:** esbuild had Linux ARM64 binaries (`@esbuild/linux-arm64`) but system needs macOS ARM64 binaries (`@esbuild/darwin-arm64`).

**Root Cause:** Node modules were likely copied from a Docker/Linux environment or installed on a different platform.

**Solution:**
- Removed incorrect `@esbuild` packages from `apps/frappe/node_modules`
- Reinstalled with `yarn install --force` to get correct platform binaries

**Files Modified:**
- `apps/frappe/node_modules/@esbuild/` - Reinstalled with correct platform

## Verification

To verify the fixes:

1. **Redis Queue:**
   ```bash
   cd frappe-bench
   ./bench-manage.sh redis-queue
   # Should show: "Running mode=standalone, port=11000"
   ```

2. **esbuild:**
   ```bash
   cd apps/frappe
   node -e "require('@esbuild/darwin-arm64'); console.log('OK')"
   # Should output: "OK"
   ```

3. **Start Bench:**
   ```bash
   ./bench-manage.sh start
   # Should start without Redis connection errors or esbuild errors
   ```

## Next Steps

1. Try starting the bench again:
   ```bash
   ./bench-manage.sh start
   ```

2. If you still see issues:
   - Check Redis logs for port confirmation
   - Verify esbuild works: `cd apps/frappe && yarn build`
   - Check `sites/common_site_config.json` has correct Redis URLs

## Notes

- Redis config files are auto-generated by `generate_redis_configs.sh`
- esbuild binaries are platform-specific and must match your OS
- All configuration should come from `.env` file (see `ENV_SETUP.md`)

